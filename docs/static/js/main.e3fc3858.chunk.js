(this["webpackJsonppopulation-count"]=this["webpackJsonppopulation-count"]||[]).push([[0],{28:function(t,e,n){t.exports={markerslist:"styles_markerslist__2giCU",markerslist__icon:"styles_markerslist__icon__3HREX"}},45:function(t,e,n){t.exports={map:"styles_map__3o9Ln",map__control__disabled:"styles_map__control__disabled__299ZE"}},56:function(t,e,n){},57:function(t,e,n){},91:function(t,e,n){"use strict";n.r(e);var r=n(7),a=n(0),i=n(12),c=n.n(i),o=(n(56),n(57),n(18)),s=n(14),u=n(17),l=n.n(u),p=n(29),f=n(26),d=n(30),m=n(93),b=n(94),g=n(95),j=n(49),_=(n(70),n(71),n(45)),v=n.n(_),O={maptiler:{url:"http://tile.digimap.ru/rumap/{z}/{x}/{y}.png?guid=93BC6341-B35E-4B34-9DFE-26796F64BBB7",attribution:""},center:{lat:57.152985,lng:65.541227},zoomLevel:10,API:"https://gis01.rumap.ru/4898/areaStatistics?guid=93BC6341-B35E-4B34-9DFE-26796F64BBB7"},h=n(46),x=n.n(h),y=n(92),k=n(3),E=n.n(k),B=n(28),w=n.n(B),C=function(t){var e=t.markers;if(0===e.length)return null;return Object(r.jsx)("div",{className:w.a.markerslist,children:e.map((function(t){var e=E.a.divIcon({className:x()(w.a.markerslist__icon),html:t.count||0});return Object(r.jsx)(y.a,{icon:e,position:t.position},t.id)}))})},F=n(47),L=n.n(F),T=function(t){var e=t.getCenter(),n=t.getBounds().getEast(),r=E.a.latLng(e.lat,n);return Math.round(e.distanceTo(r))},D=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise((function(e,n){if(!t)return n(new Error("Empty input data"));var r=O.API,a=t.getCenter(),i={method:"get",url:r,params:{x:a.lat,y:a.lng,maxdist:T(t),geometry:0}};return L()(i).then((function(t){"code"in t.data&&n(new Error(t.data.message)),"population_rs"in t.data&&e(t.data.population_rs),e(0)})).catch((function(t){n(new Error("Error getting population count data"))})),!1}))},P=function(){var t=Object(a.useState)([]),e=Object(d.a)(t,2),n=(e[0],e[1]),i=Object(a.useState)([]),c=Object(d.a)(i,2),u=c[0],_=c[1],h=Object(a.useRef)(),x=Object(a.useRef)(),y=Object(o.useToasts)().addToast,k=function(){var t=Object(f.a)(l.a.mark((function t(e){var r,a,i,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.layerType,a=e.layer,"polygon"!==r){t.next=15;break}return i=a._leaflet_id,n((function(t){return[].concat(Object(p.a)(t),[{id:i,latlngs:a.getLatLngs()[0]}])})),c=0,t.prev=5,t.next=8,D(a);case 8:c=t.sent,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(5),y(t.t0.toString(),{appearance:"error",autoDismiss:!0});case 14:_((function(t){return[].concat(Object(p.a)(t),[{id:i,position:a.getCenter(),count:c}])}));case 15:case"end":return t.stop()}}),t,null,[[5,11]])})));return function(e){return t.apply(this,arguments)}}();return Object(r.jsx)(r.Fragment,{children:Object(r.jsxs)(m.a,{center:O.center,zoom:O.zoomLevel,ref:h,className:v.a.map,children:[Object(r.jsx)(b.a,{children:Object(r.jsx)(j.a,{position:"topright",onCreated:k,onEdited:function(t){var e=t.layers._layers;Object.values(e).forEach(function(){var t=Object(f.a)(l.a.mark((function t(e){var r,a,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e._leaflet_id,a=e.editing,i=0,t.prev=2,t.next=5,D(e);case 5:i=t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),y(t.t0.toString(),{appearance:"error",autoDismiss:!0});case 11:n((function(t){return t.map((function(t){return t.id===r?Object(s.a)(Object(s.a)({},t),{},{latlngs:Object(s.a)({},a.latlngs[0])}):t}))})),_((function(t){return t.map((function(t){return t.id===r?Object(s.a)(Object(s.a)({},t),{},{position:e.getCenter(),count:i}):t}))}));case 13:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())},onDeleted:function(t){var e=t.layers._layers;Object.values(e).forEach((function(t){var e=t._leaflet_id;n((function(t){return t.filter((function(t){return t.id!==e}))})),_((function(t){return t.filter((function(t){return t.id!==e}))}))}))},draw:{rectangle:!1,polyline:!1,circle:!1,circlemarker:!1,marker:!1},ref:x})}),Object(r.jsx)(g.a,{url:O.maptiler.url,attribution:O.maptiler.attribution}),Object(r.jsx)(C,{markers:u})]})})};var S=function(){return Object(r.jsx)(o.ToastProvider,{children:Object(r.jsx)(P,{})})},I=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,96)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,c=e.getTTFB;n(t),r(t),a(t),i(t),c(t)}))};n(90);c.a.render(Object(r.jsx)(S,{}),document.getElementById("root")),I()}},[[91,1,2]]]);
//# sourceMappingURL=main.e3fc3858.chunk.js.map